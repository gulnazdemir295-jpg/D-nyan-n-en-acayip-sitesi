<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ürün Ekle - Dünyanın En Acayip Sitesi</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #000000;
            color: #ffffff;
            text-align: center;
            padding: 50px;
        }
        h1 {
            font-style: italic;
        }
        form {
            max-width: 600px;
            margin: 0 auto;
            text-align: left;
        }
        label {
            display: block;
            margin: 10px 0 5px;
        }
        input, select {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ff0000;
            border-radius: 5px;
            background-color: #ffffff;
            color: #000000;
        }
        .button {
            background-color: #ff0000;
            color: #ffffff;
            padding: 15px 30px;
            margin: 10px;
            text-decoration: none;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
        }
        .button:hover {
            background-color: #cc0000;
        }
    </style>
</head>
<body>
    <h1><i>Ürün Ekle</i></h1>
    <p>Yeni ürün ekleyin.</p>

    <form id="addProductForm">
        <label>Ürün Adı: <input type="text" id="productName" required></label>
        <label>Barkod: <input type="text" id="barcode" required></label>
        <label>Stok: <input type="number" id="stock" required></label>
        <label>Fiyat: <input type="number" step="0.01" id="price" required></label>
        <label id="expiryLabel" style="display: none;">SKT: <input type="date" id="expiryDate" required></label>
        <label id="warningLabel" style="display: none;">Uyarı Günü (SKT'den kaç gün önce uyarı verilsin): <input type="number" id="warningDays" min="0" required></label>
        <label>Kategori:
            <select id="category" required>
                <option value="">Seçin</option>
                <option value="hammadde">Hammadde</option>
                <option value="uretim">Üretim</option>
                <option value="toptan">Toptan</option>
                <option value="satis">Satış</option>
                <option value="Yöresel Lezzetler">Yöresel Lezzetler</option>
                <option value="El Sanatları">El Sanatları</option>
            </select>
        </label>

        <label>Ülke:
            <select id="country" required>
                <option value="">Seçin</option>
                <option value="Türkiye">Türkiye</option>
                <option value="İtalya">İtalya</option>
                <option value="Yunanistan">Yunanistan</option>
                <option value="İspanya">İspanya</option>
                <option value="Fransa">Fransa</option>
                <option value="Japonya">Japonya</option>
                <option value="Meksika">Meksika</option>
                <option value="Hindistan">Hindistan</option>
                <option value="Çin">Çin</option>
                <option value="Brezilya">Brezilya</option>
            </select>
        </label>

        <label>Bölge/Şehir: <input type="text" id="region" placeholder="Örn: Marmara, İstanbul" required></label>

        <label>Kültürel Bilgi (Opsiyonel): <textarea id="culturalInfo" rows="3" placeholder="Ürünün kültürel önemi, tarihi, gelenekleri..."></textarea></label>
        <label>Fotoğraf: <input type="file" id="photo" accept="image/*"></label>
        <label>Video: <input type="file" id="video" accept="video/*"></label>
        <label>Ürün Tanıtımı İçin Canlı Yayın: <input type="checkbox" id="liveBroadcast"></label>
        <label>Numune Ürün: <input type="checkbox" id="isSample"></label>
        <label>Komisyon Oranı (%): <input type="number" step="0.01" id="commissionRate" min="0" max="100"></label>
        <button type="submit" class="button">Ürün Ekle</button>
    </form>

    <div id="liveBroadcastArea" style="display: none; margin-top: 20px;">
        <h3>Canlı Yayın İzle</h3>
        <video id="liveVideo" controls style="width: 100%; max-width: 600px;">
            <source src="" type="video/mp4">
            Tarayıcınız video etiketini desteklemiyor.
        </video>
        <p>Canlı yayın aktif değil.</p>
    </div>

    <a href="urun-yonetimi.html" class="button">Ürünleri Listele</a>
    <a href="index.html" class="button">Ana Sayfa</a>

    <script>
        function getPanel() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('panel') || 'general';
        }

        function toggleExpiryField() {
            const panel = getPanel();
            const expiryLabel = document.getElementById('expiryLabel');
            const expiryInput = document.getElementById('expiryDate');
            const warningLabel = document.getElementById('warningLabel');
            const warningInput = document.getElementById('warningDays');
            if (panel === 'yoresel-lezzetler') {
                expiryLabel.style.display = 'block';
                expiryInput.required = true;
                warningLabel.style.display = 'block';
                warningInput.required = true;
            } else {
                expiryLabel.style.display = 'none';
                expiryInput.required = false;
                warningLabel.style.display = 'none';
                warningInput.required = false;
            }
        }

        document.getElementById('addProductForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const productName = document.getElementById('productName').value;
            const barcode = document.getElementById('barcode').value;
            const stock = document.getElementById('stock').value;
            const price = document.getElementById('price').value;
            const category = document.getElementById('category').value;
            const photo = document.getElementById('photo').files[0];
            const video = document.getElementById('video').files[0];
            const liveBroadcast = document.getElementById('liveBroadcast').checked;
            const isSample = document.getElementById('isSample').checked;
            const commissionRate = parseFloat(document.getElementById('commissionRate').value) || 0;
            const panel = getPanel();

            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const country = document.getElementById('country').value;
            const region = document.getElementById('region').value;
            const culturalInfo = document.getElementById('culturalInfo').value;

            const expiryDate = document.getElementById('expiryDate').value;
            const warningDays = document.getElementById('warningDays').value;

            const product = {
                name: productName,
                barcode: barcode,
                stock: stock,
                price: price,
                category: category,
                country: country,
                region: region,
                culturalInfo: culturalInfo,
                photo: '',
                video: '',
                liveBroadcast: liveBroadcast,
                isSample: isSample,
                commissionRate: commissionRate,
                panel: panel,
                company: currentUser ? currentUser.company : '',
                city: currentUser ? currentUser.city : '',
                district: currentUser ? currentUser.district : '',
                region: currentUser ? currentUser.region : '',
                expiryDate: expiryDate,
                warningDays: warningDays,
                addedDate: new Date().toISOString()
            };

            const key = 'products-' + panel;
            let products = JSON.parse(localStorage.getItem(key)) || [];

            // Handle photo
            if (photo) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    product.photo = e.target.result;
                    // Handle video
                    if (video) {
                        const videoReader = new FileReader();
                        videoReader.onload = function(ve) {
                            product.video = ve.target.result;
                            products.push(product);
                            localStorage.setItem(key, JSON.stringify(products));
                            finalizeAdd();
                        };
                        videoReader.readAsDataURL(video);
                    } else {
                        products.push(product);
                        localStorage.setItem(key, JSON.stringify(products));
                        finalizeAdd();
                    }
                };
                reader.readAsDataURL(photo);
            } else {
                // Handle video if no photo
                if (video) {
                    const videoReader = new FileReader();
                    videoReader.onload = function(ve) {
                        product.video = ve.target.result;
                        products.push(product);
                        localStorage.setItem(key, JSON.stringify(products));
                        finalizeAdd();
                    };
                    videoReader.readAsDataURL(video);
                } else {
                    products.push(product);
                    localStorage.setItem(key, JSON.stringify(products));
                    finalizeAdd();
                }
            }

            function finalizeAdd() {
                if (liveBroadcast) {
                    document.getElementById('liveBroadcastArea').style.display = 'block';
                    // Placeholder for live broadcast
                    document.getElementById('liveVideo').src = 'placeholder-video.mp4'; // Replace with actual
                    alert('Canlı yayın başlatıldı!');
                } else {
                    document.getElementById('liveBroadcastArea').style.display = 'none';
                }

                alert('Ürün eklendi!');
                document.getElementById('addProductForm').reset();
                toggleExpiryField(); // Reset expiry field visibility
            }
        });

        // Initialize
        toggleExpiryField();
    </script>
</body>
</html>
