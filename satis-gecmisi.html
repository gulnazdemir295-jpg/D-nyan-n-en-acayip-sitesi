<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Satış Geçmişi - Dünyanın En Acayip Sitesi</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #000000;
            color: #ff0000;
            text-align: center;
            padding: 50px;
        }
        h1 {
            font-style: italic;
        }
        .sales-container {
            background-color: #ffffff;
            color: #000000;
            padding: 20px;
            border-radius: 5px;
            margin: 20px auto;
            max-width: 1200px;
        }
        .sale-card {
            border: 1px solid #ff0000;
            margin: 10px 0;
            padding: 15px;
            border-radius: 5px;
            text-align: left;
        }
        .sale-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .sale-total {
            font-size: 18px;
            font-weight: bold;
            color: #ff0000;
        }
        .sale-items {
            margin-top: 10px;
        }
        .sale-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        .button {
            display: inline-block;
            background-color: #ff0000;
            color: #ffffff;
            padding: 10px 20px;
            margin: 5px;
            text-decoration: none;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }
        .button:hover {
            background-color: #cc0000;
        }
        .filters {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        .filters input, .filters select {
            padding: 8px;
            border: 1px solid #ff0000;
            border-radius: 5px;
        }
        .summary {
            background-color: #f0f0f0;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .summary-item {
            display: inline-block;
            margin: 0 15px;
        }
    </style>
</head>
<body>
    <h1><i>Satış Geçmişi</i></h1>
    <p>Dükkan satışlarınızın geçmişini görüntüleyin</p>

    <div class="sales-container">
        <div class="summary" id="salesSummary">
            <!-- Sales summary will be displayed here -->
        </div>

        <div class="filters">
            <input type="date" id="startDate">
            <input type="date" id="endDate">
            <button class="button" onclick="filterSales()">Filtrele</button>
            <button class="button" onclick="exportSales()">Dışa Aktar</button>
        </div>

        <div id="salesList">
            <!-- Sales will be displayed here -->
        </div>
    </div>

    <a href="dukkan-pos.html" class="button">POS'a Dön</a>
    <a href="index.html" class="button">Ana Sayfa</a>

    <script>
        let allSales = [];
        let currentUser = JSON.parse(localStorage.getItem('currentUser')) || {};

        // Load sales history
        function loadSalesHistory() {
            allSales = JSON.parse(localStorage.getItem('pos-sales')) || [];
            // Filter sales for current user/company
            const userSales = allSales.filter(sale => sale.user === currentUser.company);
            displaySales(userSales);
            displaySummary(userSales);
        }

        // Display sales summary
        function displaySummary(sales) {
            const totalSales = sales.length;
            const totalRevenue = sales.reduce((sum, sale) => sum + sale.total, 0);
            const today = new Date().toDateString();
            const todaySales = sales.filter(sale => new Date(sale.timestamp).toDateString() === today);

            document.getElementById('salesSummary').innerHTML = `
                <div class="summary-item"><strong>Toplam Satış:</strong> ${totalSales}</div>
                <div class="summary-item"><strong>Toplam Gelir:</strong> ${totalRevenue.toFixed(2)} TL</div>
                <div class="summary-item"><strong>Bugünkü Satış:</strong> ${todaySales.length}</div>
                <div class="summary-item"><strong>Bugünkü Gelir:</strong> ${todaySales.reduce((sum, sale) => sum + sale.total, 0).toFixed(2)} TL</div>
            `;
        }

        // Display sales
        function displaySales(sales) {
            const container = document.getElementById('salesList');
            container.innerHTML = '';

            if (sales.length === 0) {
                container.innerHTML = '<p>Henüz satış kaydı bulunmuyor.</p>';
                return;
            }

            sales.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            sales.forEach(sale => {
                const saleCard = document.createElement('div');
                saleCard.className = 'sale-card';

                const saleDate = new Date(sale.timestamp).toLocaleString('tr-TR');

                saleCard.innerHTML = `
                    <div class="sale-header">
                        <div>
                            <strong>Satış ID:</strong> ${sale.id}<br>
                            <strong>Tarih:</strong> ${saleDate}
                        </div>
                        <div class="sale-total">${sale.total.toFixed(2)} TL</div>
                    </div>
                    <div class="sale-items">
                        ${sale.items.map(item => `
                            <div class="sale-item">
                                <span>${item.name} (${item.quantity} adet)</span>
                                <span>${(item.price * item.quantity).toFixed(2)} TL</span>
                            </div>
                        `).join('')}
                    </div>
                `;

                container.appendChild(saleCard);
            });
        }

        // Filter sales by date
        function filterSales() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;

            let filteredSales = allSales.filter(sale => sale.user === currentUser.company);

            if (startDate) {
                filteredSales = filteredSales.filter(sale =>
                    new Date(sale.timestamp) >= new Date(startDate)
                );
            }

            if (endDate) {
                const end = new Date(endDate);
                end.setHours(23, 59, 59, 999);
                filteredSales = filteredSales.filter(sale =>
                    new Date(sale.timestamp) <= end
                );
            }

            displaySales(filteredSales);
            displaySummary(filteredSales);
        }

        // Export sales to CSV
        function exportSales() {
            const userSales = allSales.filter(sale => sale.user === currentUser.company);

            if (userSales.length === 0) {
                alert('Dışa aktarılacak satış bulunmuyor.');
                return;
            }

            let csv = 'Satış ID,Tarih,Ürün,Miktar,Birim Fiyat,Toplam\n';

            userSales.forEach(sale => {
                sale.items.forEach(item => {
                    csv += `${sale.id},${new Date(sale.timestamp).toLocaleString('tr-TR')},${item.name},${item.quantity},${item.price},${item.price * item.quantity}\n`;
                });
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'satis-gecmisi.csv';
            a.click();
            window.URL.revokeObjectURL(url);
        }

        // Initialize
        loadSalesHistory();
    </script>
</body>
</html>
